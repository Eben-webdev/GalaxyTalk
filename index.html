<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GalaxyTalk</title>
<script src="https://kit.fontawesome.com/c0477c40ad.js" crossorigin="anonymous"></script>
<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }
body { margin:0; background:black; color:#eee; overflow:hidden; }

/* Site Access & Login */
#siteAccess, #login { height:100vh; display:flex; align-items:center; justify-content:center; }
.box { background: rgba(60,0,90,0.85); padding:25px; border-radius:12px; width:360px; text-align:center; }
input { width:100%; padding:10px; margin-top:10px; border-radius:8px; border:none; }
button { cursor:pointer; background:black; color:white; border:1px solid purple; padding:10px; border-radius:8px; }
button:hover { background:purple; }
.error { color:#ff6b6b; font-size:14px; display:none; margin-top:5px; }

/* Chat Layout */
#app { display:none; height:100vh; flex-direction:row; }
#sidebar { width:260px; background:#120018; padding:10px; display:flex; flex-direction:column; }
#users { flex:1; overflow-y:auto; }
.user { padding:10px; border-bottom:1px solid #222; display:flex; align-items:center; gap:8px; cursor:pointer; }
.dotStatus { width:8px; height:8px; border-radius:50%; }
.online { background:#4cff4c; }
.offline { background:#777; }
#chatArea { flex:1; display:flex; flex-direction:column; }
#messages { flex:1; padding:10px; overflow-y:auto; }
.msg { margin-bottom:6px; }
.me { color:#7aa2ff; }
#typingIndicator { height:18px; font-style:italic; color:#bbb; display:flex; align-items:center; }
.dot { opacity:0; animation:blink 1.4s infinite both; }
.dot:nth-child(2){animation-delay:0s} .dot:nth-child(3){animation-delay:.2s} .dot:nth-child(4){animation-delay:.4s}
@keyframes blink{0%{opacity:0}20%{opacity:1}100%{opacity:0}}
#inputBar { display:flex; gap:8px; padding:10px; background:#0f1440; }
#msgInput { flex:1; padding:14px; font-size:15px; border-radius:6px; border:none; }
#sendBtn { width:46px; display:flex; align-items:center; justify-content:center; border-radius:6px; }

/* Settings Button & Overlay */
#settingsBtn { position:fixed; bottom:15px; left:15px; width:42px; height:42px; border-radius:50%; background:#6a5cff; color:#fff; border:none; font-size:20px; }
#settingsOverlay { position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:999; display:none; }
#settingsContainer { width:90%; height:90%; margin:auto; background:#0e0e10; display:flex; border-radius:10px; overflow:hidden; }
#settingsSidebar { width:240px; background:#1e1f22; padding:10px; display:flex; flex-direction:column; gap:6px; }
#settingsSidebar h4 { color:#b5bac1; margin-bottom:10px; }
.tabBtn { background:none; border:none; color:#dbdee1; padding:10px; border-radius:6px; text-align:left; display:flex; gap:10px; align-items:center; cursor:pointer; }
.tabBtn:hover, .tabBtn.active { background:#2b2d31; }
.closeBtn { margin-top:auto; background:#ed4245; }
#settingsContent { flex:1; padding:25px; overflow-y:auto; }
.settingsTab { display:none; }
.settingsTab.active { display:block; }

</style>
</head>
<body>

<!-- SITE ACCESS -->
<div id="siteAccess">
  <div class="box">
    <h2>GalaxyTalk</h2>
    <input id="sitePass" type="password" placeholder="Enter site password">
    <div id="siteError" class="error"></div>
    <button onclick="checkSitePass()">Enter</button>
  </div>
</div>

<!-- LOGIN -->
<div id="login" style="display:none">
  <div class="box">
    <h3>Login</h3>
    <input id="userInput" placeholder="Username">
    <input id="pinInput" type="password" placeholder="4-digit PIN">
    <div id="loginError" class="error"></div>
    <button onclick="loginUser()">Login</button>
  </div>
</div>

<!-- CHAT APP -->
<div id="app">
  <div id="sidebar">
    <div id="users"></div>
  </div>
  <div id="chatArea">
    <div id="messages"></div>
    <div id="typingIndicator"><span id="typingText"></span><span class="dot">.</span><span class="dot">.</span><span class="dot">.</span></div>
    <div id="inputBar">
      <input id="msgInput" placeholder="Message">
      <button id="sendBtn" onclick="sendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>
  <button id="settingsBtn" onclick="openSettings()"><i class="fa-solid fa-gear"></i></button>
</div>

<!-- SETTINGS OVERLAY -->
<div id="settingsOverlay">
  <div id="settingsContainer">
    <div id="settingsSidebar">
      <h4>User Settings</h4>
      <button onclick="openTab('account')" class="tabBtn active"><i class="fa-solid fa-circle-user"></i> My Account</button>
      <button onclick="openTab('security')" class="tabBtn"><i class="fa-regular fa-camera-cctv"></i> Security</button>
      <button onclick="openTab('appearance')" class="tabBtn"><i class="fa-solid fa-palette"></i> Appearance</button>
      <button onclick="openTab('admin')" class="tabBtn adminOnly"><i class="fa-solid fa-screwdriver-wrench"></i> Admin</button>
      <button onclick="closeSettings()" class="closeBtn">Close</button>
    </div>
    <div id="settingsContent">
      <div id="account" class="settingsTab active">
        <h2>My Account</h2>
        <p><b>Username:</b> <span id="whoami"></span></p>
      </div>
      <div id="security" class="settingsTab"><h2>Security</h2><p>Change password & security settings here.</p></div>
      <div id="appearance" class="settingsTab"><h2>Appearance</h2><p>Theme customization here.</p></div>
      <div id="admin" class="settingsTab"><h2>Admin Panel</h2><p>Admin-only tools.</p></div>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

/* --- FIREBASE CONFIG --- */
const firebaseConfig = {
  apiKey: "AIzaSyB5AN9HLYx59Yue-aNb5ACHFKuy7X7aFPQ",
  authDomain: "galaxytalk-7d3bd.firebaseapp.com",
  databaseURL: "https://galaxytalk-7d3bd-default-rtdb.firebaseio.com",
  projectId: "galaxytalk-7d3bd"
};
const fb = initializeApp(firebaseConfig);
const db = getDatabase(fb);

/* --- SITE ACCESS --- */
const SITE_PASSWORD = "1886";
function checkSitePass() {
  const val = document.getElementById('sitePass').value.trim();
  const err = document.getElementById('siteError');
  if(val === SITE_PASSWORD){
    document.getElementById('siteAccess').style.display = 'none';
    document.getElementById('login').style.display = 'flex';
    err.style.display = 'none';
  } else {
    err.textContent = "Wrong site password";
    err.style.display = "block";
  }
}

/* --- USERS --- */
const USERS = {
  "Faheemah":"9846","SamuelR":"5891","SamuelC":"2339","Ethan":"8213",
  "Elnathan":"9999","Caroline":"4006","Molly":"2296","Zara":"6701",
  "Danny":"7494","Shell-Lee":"0754","Raygan":"5124","Jacob":"7596",
  "Nathan":"2006","Kiera":"4888","Karter":"1115","Meadleen":"5565",
  "Eli":"0758","Hadlee":"9160"
};

let currentUser = null;
let currentChat = "global";

/* --- LOGIN --- */
function loginUser() {
  const u = document.getElementById('userInput').value.trim();
  const p = document.getElementById('pinInput').value.trim();
  const err = document.getElementById('loginError');
  if(!u || !p){ err.textContent="Enter username & PIN"; err.style.display="block"; return; }
  if(USERS[u] && USERS[u] === p){
    currentUser = u;
    document.getElementById('login').style.display='none';
    document.getElementById('app').style.display='flex';
    document.getElementById('whoami').textContent = currentUser;
    err.style.display="none";
    loadMessages();
  } else { err.textContent="Invalid username or PIN"; err.style.display="block"; }
}

/* --- SETTINGS --- */
function openSettings(){ document.getElementById('settingsOverlay').style.display='flex'; }
function closeSettings(){ document.getElementById('settingsOverlay').style.display='none'; }
function openTab(name){
  document.querySelectorAll('.settingsTab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active'));
  document.getElementById(name).classList.add('active');
  event.currentTarget.classList.add('active');
}

/* --- FIREBASE CHAT --- */
const messagesEl = document.getElementById('messages');
const msgInputEl = document.getElementById('msgInput');

function loadMessages(){
  onValue(ref(db,"messages/global"),snap=>{
    messagesEl.innerHTML="";
    snap.forEach(m=>{
      const div=document.createElement('div');
      div.className="msg"+(m.val().user===currentUser?" me":"");
      div.textContent = `${m.val().user}: ${m.val().text}`;
      messagesEl.appendChild(div);
    });
    messagesEl.scrollTop = messagesEl.scrollHeight;
  });
}

function sendMessage(){
  if(!msgInputEl.value.trim()) return;
  push(ref(db,"messages/global"),{user:currentUser,text:msgInputEl.value});
  msgInputEl.value="";
}
</script>
</body>
</html>
