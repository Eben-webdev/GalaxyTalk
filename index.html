<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GalaxyTalk</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{margin:0;color:#fff;background:black;overflow:hidden}
.hidden{display:none}

/* üåå Space background */
canvas{position:fixed;inset:0;z-index:-1}

/* Access + Login */
.center{height:100vh;display:flex;align-items:center;justify-content:center}
.card{background:rgba(60,0,90,.9);padding:25px;border-radius:14px;width:340px;box-shadow:0 0 25px purple}
input{width:100%;padding:12px;border-radius:8px;border:none;margin-top:10px}
button{padding:8px 12px;border-radius:6px;border:1px solid purple;background:black;color:white;cursor:pointer}
button:hover{background:purple}

/* App Layout */
#app{height:100vh;display:flex}
#sidebar{width:260px;background:#120018;padding:10px}
.user{padding:8px;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:8px}
.user:hover{background:rgba(128,0,128,.3)}
.dot{width:8px;height:8px;border-radius:50%}
.online{background:#4cff4c}
.offline{background:#777}

#chat{flex:1;display:flex;flex-direction:column}
#messages{flex:1;padding:10px;overflow-y:auto}
.msg{background:rgba(128,0,128,.35);padding:6px;border-radius:6px;margin-bottom:6px}
.me{border:1px solid #7aa2ff}

/* Input */
#inputBar{display:flex;gap:6px;padding:10px}
#msgInput{flex:1;font-size:16px;padding:14px}
#sendBtn{width:70px}

/* Typing */
#typing{font-style:italic;color:#bbb;height:18px}

/* Settings */
#settingsBtn{position:fixed;bottom:15px;left:15px;width:42px;height:42px;border-radius:50%;font-size:18px}
#settings{position:fixed;bottom:70px;left:15px;width:280px;background:#141a4f;border-radius:12px;padding:15px}
</style>
</head>

<body>

<canvas id="space"></canvas>

<!-- SITE ACCESS -->
<div id="access" class="center">
  <div class="card">
    <h2>Enter Site Password</h2>
    <input id="sitePass" type="password" placeholder="1886">
    <button onclick="checkSite()">Enter</button>
  </div>
</div>

<!-- LOGIN -->
<div id="login" class="center hidden">
  <div class="card">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="pin" type="password" inputmode="numeric" placeholder="4-digit PIN">
    <div id="loginErr" style="color:#ff6b6b"></div>
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <div id="sidebar">
    <h3>üåç Global</h3>
    <div class="user" onclick="openGlobal()">Everyone</div>
    <hr>
    <div id="users"></div>
  </div>

  <div id="chat">
    <div id="messages"></div>
    <div id="typing"></div>
    <div id="inputBar">
      <input id="msgInput" placeholder="Message...">
      <button id="sendBtn" onclick="send()">Send</button>
    </div>
  </div>

  <button id="settingsBtn" onclick="toggleSettings()">‚öô</button>
  <div id="settings" class="hidden">
    <h3>Settings</h3>
    <p id="whoami"></p>
    <button onclick="logout()">Log out</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getDatabase, ref, push, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

/* üîê USERS (STRING PINS) */
const USERS={
"Faheemah":"9846","SamuelR":"5891","SamuelC":"2339","Ethan":"8213",
"Elnathan":"9999","Caroline":"4006","Molly":"2296","Zara":"6701",
"Danny":"7494","Shell-Lee":"0754","Raygan":"5124","Jacob":"7596",
"Nathan":"2006","Kiera":"4888","Karter":"1115","Meadleen":"5565",
"Eli":"0758","Hadlee":"9160"
};

const SITE_PASSWORD="1886";

const appFB=initializeApp({
  apiKey:"YOUR_API_KEY",
  databaseURL:"YOUR_DB_URL",
  projectId:"YOUR_PROJECT"
});
const db=getDatabase(appFB);

let currentUser=null;
let currentChat="global";

/* PASSWORD */
window.checkSite=()=>{
  if(String(sitePass.value).trim()===SITE_PASSWORD){
    access.classList.add("hidden");
    login.classList.remove("hidden");
  }else alert("Wrong site password");
};

/* LOGIN */
window.login=()=>{
  const u=username.value.trim();
  const p=pin.value.trim();

  if(!USERS[u]||String(USERS[u])!==String(p)){
    loginErr.textContent="Invalid login";
    return;
  }

  currentUser=u;
  whoami.textContent="Logged in as "+u;

  login.classList.add("hidden");
  app.classList.remove("hidden");

  loadUsers();
  openGlobal();
};

/* USERS */
function loadUsers(){
  users.innerHTML="";
  Object.keys(USERS).forEach(u=>{
    if(u===currentUser)return;
    const d=document.createElement("div");
    d.className="user";
    d.innerHTML=`<div class="dot offline"></div>${u}`;
    d.onclick=()=>openDM(u);
    users.appendChild(d);
  });
}

/* CHAT */
function openGlobal(){
  currentChat="global";
  listen("messages/global");
}
function openDM(u){
  currentChat=[currentUser,u].sort().join("_");
  listen("messages/dm/"+currentChat);
}

function listen(path){
  messages.innerHTML="";
  onValue(ref(db,path),snap=>{
    messages.innerHTML="";
    snap.forEach(m=>{
      const div=document.createElement("div");
      div.className="msg"+(m.val().user===currentUser?" me":"");
      div.textContent=m.val().user+": "+m.val().text;
      if(m.val().user===currentUser){
        div.onclick=()=>remove(ref(db,path+"/"+m.key));
      }
      messages.appendChild(div);
    });
  });
}

window.send=()=>{
  if(!msgInput.value)return;
  const path=currentChat==="global"?"messages/global":"messages/dm/"+currentChat;
  push(ref(db,path),{user:currentUser,text:msgInput.value});
  msgInput.value="";
};

/* SETTINGS */
window.toggleSettings=()=>settings.classList.toggle("hidden");
window.logout=()=>location.reload();
</script>

<script>
/* üåå Space animation */
const c=document.getElementById("space"),ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
window.onresize=resize;resize();
let stars=Array.from({length:200},()=>({x:Math.random()*c.width,y:Math.random()*c.height,r:Math.random()*1.5,a:Math.random()}));
(function anim(){
  ctx.clearRect(0,0,c.width,c.height);
  stars.forEach(s=>{
    s.a+= (Math.random()-.5)*.05;
    s.a=Math.max(0,Math.min(1,s.a));
    ctx.fillStyle=`rgba(255,255,255,${s.a})`;
    ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();
  });
  requestAnimationFrame(anim);
})();
</script>

</body>
</html>
