<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GalaxyTalk</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{margin:0;background:black;color:white;overflow:hidden}
.hidden{display:none}

/* Space background */
canvas{position:fixed;inset:0;z-index:-1}

/* Center cards */
.center{height:100vh;display:flex;align-items:center;justify-content:center}
.card{background:rgba(80,0,120,.85);padding:25px;border-radius:12px;width:320px;box-shadow:0 0 30px purple}
input,button{width:100%;padding:10px;margin-top:10px;border-radius:8px;border:none}
button{background:black;color:white;border:1px solid purple;cursor:pointer}
button:hover{background:purple}

/* Layout */
#app{display:flex;height:100vh}
#sidebar{width:260px;background:#120018;padding:10px;overflow-y:auto}
.user{display:flex;align-items:center;gap:8px;padding:6px;border-radius:6px;cursor:pointer}
.user:hover{background:rgba(255,255,255,.1)}
.dot{width:8px;height:8px;border-radius:50%}
.online{background:#3cff3c}
.offline{background:#777}

#chat{flex:1;display:flex;flex-direction:column}
#messages{flex:1;padding:10px;overflow-y:auto}
.msg{margin-bottom:6px;padding:6px;border-radius:6px;background:rgba(150,0,200,.35)}
.me{border:1px solid #7aa2ff}

/* Typing */
#typing{height:20px;font-style:italic;color:#bbb}

/* Input */
#inputBar{display:flex;gap:6px;padding:10px}
#msg{flex:1;padding:12px}
#send{width:80px}

/* Settings */
#settingsBtn{position:fixed;bottom:15px;left:15px;width:44px;height:44px;border-radius:50%;font-size:18px}
#settings{position:fixed;inset:0;background:#0b0014;display:flex}
#settingsSidebar{width:200px;background:#14001f;padding:10px}
#settingsMain{flex:1;padding:20px}
.tab{display:none}
.tab.active{display:block}
</style>
</head>
<body>

<canvas id="space"></canvas>

<!-- SITE ACCESS -->
<div id="access" class="center">
  <div class="card">
    <h2>GalaxyTalk</h2>
    <input id="sitePass" type="password" placeholder="Site password">
    <button onclick="checkSite()">Enter</button>
  </div>
</div>

<!-- LOGIN -->
<div id="login" class="center hidden">
  <div class="card">
    <h3>Login</h3>
    <input id="username" placeholder="Username">
    <input id="pin" type="password" inputmode="numeric" placeholder="4-digit PIN">
    <div id="loginErr" style="color:#ff6b6b"></div>
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <div id="sidebar"></div>

  <div id="chat">
    <div id="messages"></div>
    <div id="typing"></div>
    <div id="inputBar">
      <input id="msg" placeholder="Message">
      <button id="send" onclick="send()">Send</button>
    </div>
  </div>

  <button id="settingsBtn" onclick="openSettings()">âš™</button>
</div>

<!-- SETTINGS -->
<div id="settings" class="hidden">
  <div id="settingsSidebar">
    <button onclick="openTab('account')">Account</button>
    <button onclick="openTab('notifications')">Notifications</button>
    <button onclick="closeSettings()">Close</button>
  </div>
  <div id="settingsMain">
    <div id="account" class="tab active">
      <h3>Account</h3>
      <p id="who"></p>
      <button onclick="logout()">Log out</button>
    </div>
    <div id="notifications" class="tab">
      <h3>Notifications</h3>
      <button onclick="enableNotifications()">Enable</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getDatabase, ref, push, onValue, set, onDisconnect } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyB5AN9HLYx59Yue-aNb5ACHFKuy7X7aFPQ",
  authDomain: "galaxytalk-7d3bd.firebaseapp.com",
  databaseURL: "https://galaxytalk-7d3bd-default-rtdb.firebaseio.com",
  projectId: "galaxytalk-7d3bd"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* PASSWORDS */
const SITE_PASSWORD = "1886";
const USERS={
"Faheemah":"9846","SamuelR":"5891","SamuelC":"2339","Ethan":"8213",
"Elnathan":"9999","Caroline":"4006","Molly":"2296","Zara":"6701",
"Danny":"7494","Shell-Lee":"0754","Raygan":"5124","Jacob":"7596",
"Nathan":"2006","Kiera":"4888","Karter":"1115","Meadleen":"5565",
"Eli":"0758","Hadlee":"9160"
};

let me=null;
let chat="global";

/* SITE ACCESS */
window.checkSite=function(){
  if(sitePass.value.trim()===SITE_PASSWORD){
    access.classList.add("hidden");
    login.classList.remove("hidden");
  }else alert("Wrong site password");
};

/* LOGIN */
window.login=function(){
  const u=username.value.trim();
  const p=pin.value.trim();
  if(!USERS[u]||USERS[u]!==p){
    loginErr.textContent="Invalid login";
    return;
  }
  me=u;
  login.classList.add("hidden");
  app.classList.remove("hidden");
  who.textContent="Logged in as "+u;

  set(ref(db,"status/"+u),true);
  onDisconnect(ref(db,"status/"+u)).set(false);

  loadUsers();
  listen();
};

/* USERS */
function loadUsers(){
  onValue(ref(db,"status"),snap=>{
    sidebar.innerHTML="<h3>DMs</h3>";
    snap.forEach(s=>{
      if(s.key!==me){
        const d=document.createElement("div");
        d.className="user";
        d.innerHTML=`<div class="dot ${s.val()?'online':'offline'}"></div>${s.key}`;
        d.onclick=()=>openDM(s.key);
        sidebar.appendChild(d);
      }
    });
  });
}

/* DMS */
function openDM(u){
  chat=[me,u].sort().join("_");
  listen();
}

/* MESSAGES */
function listen(){
  messages.innerHTML="";
  onValue(ref(db,"messages/"+chat),snap=>{
    messages.innerHTML="";
    snap.forEach(m=>{
      const d=document.createElement("div");
      d.className="msg"+(m.val().user===me?" me":"");
      d.textContent=m.val().user+": "+m.val().text;
      if(m.val().user===me){
        d.ondblclick=()=>{
          const t=prompt("Edit message",m.val().text);
          if(t)set(ref(db,"messages/"+chat+"/"+m.key+"/text"),t);
        };
      }
      messages.appendChild(d);
    });
    messages.scrollTop=messages.scrollHeight;
  });
}

/* SEND */
window.send=function(){
  if(!msg.value)return;
  push(ref(db,"messages/"+chat),{user:me,text:msg.value});
  msg.value="";
};

/* SETTINGS */
window.openSettings=()=>settings.classList.remove("hidden");
window.closeSettings=()=>settings.classList.add("hidden");
window.openTab=name=>{
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.getElementById(name).classList.add("active");
};
window.logout=()=>location.reload();

/* NOTIFICATIONS */
window.enableNotifications=async()=>{
  const p=await Notification.requestPermission();
  if(p==="granted")new Notification("GalaxyTalk enabled");
};
</script>

<script>
/* SPACE BACKGROUND */
const c=document.getElementById("space"),x=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
window.onresize=resize;resize();
let stars=[...Array(200)].map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,r:Math.random()*1.5,a:Math.random()}));
(function anim(){
  x.clearRect(0,0,c.width,c.height);
  stars.forEach(s=>{
    s.a+= (Math.random()-.5)*.05;
    s.a=Math.max(0,Math.min(1,s.a));
    x.fillStyle=`rgba(255,255,255,${s.a})`;
    x.beginPath();x.arc(s.x,s.y,s.r,0,Math.PI*2);x.fill();
  });
  requestAnimationFrame(anim);
})();
</script>

</body>
</html>
